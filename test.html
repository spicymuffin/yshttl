<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<title>연세대학교 로그인</title>


<link rel="shortcut icon" type="image/x-icon" href="/sso/user/pm/img/icon.ico">
<!-- 삭제예정 -->
<!--<link rel="stylesheet" type="text/css" href="/sso/user/pm/css/style.css">-->




<!-- 22.08.05 신규 디자인 적용 Start -->
<meta charset="utf-8">
<meta name="description" content="">
<link rel="stylesheet" href="/sso/login/lib/css/webfonts.css">
<link rel="stylesheet" href="/sso/login/lib/css/default.css">
<!-- 22.08.05 신규 디자인 적용 End -->

<style>
/* IE에서만 적용 */
 @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) and (min-width:1280px) {
    #ssoLoginForm {
        display:flex !important;
        width:100%;
    }
}
</style>



<!-- script 태그에서 가져오는 자바스크립트 파일의 순서에 주의해야한다! 순서가 틀릴경우 자바스크립트 오류가 발생한다. -->
<script type="text/javascript" src="/sso/js/rsa/jsbn.js"></script>
<script type="text/javascript" src="/sso/js/rsa/rsa.js"></script>
<script type="text/javascript" src="/sso/js/rsa/prng4.js"></script>
<script type="text/javascript" src="/sso/js/rsa/rng.js"></script>


<script src="https://code.jquery.com/jquery-1.12.1.min.js"></script>






<!-- 22.08.05 신규 디자인 적용 Start -->
<script src="/sso/login/lib/js/jquery-ui-custom.js"></script>
<!--<script src="/sso/login/lib/js/default.js"></script>-->
<!-- 22.08.05 신규 디자인 적용 End -->

<script type="text/javascript" src="/sso/js/common/prototype.js"></script>
<script type="text/javascript" src="/sso/js/common/eventKeyBlock.js"></script>
<script type="text/javascript" src="/sso/js/common/cookieUtil.js"></script>
<script type="text/javascript" src="/sso/js/enc/sha256.js"></script>





<script type="text/javascript">


/**
 * Body Onload 시 호출
 */
function fInitialize() {

    var login_url = '';
    var returnMessage = '';
    var base_root = '/sso';

    var test = '';
    var retCode = '';
    if( login_url != '' ) {
        if( test  != 'SSOLogin' ){
            document.ssoLoginForm.submit();
        }else{
            if( returnMessage != '' ) {
                if( retCode == '[PM_UAN]038' ) {
                    var w = 550;
                    var h = 450;
                    var l = screen.width/2 - w/2 - 200;
                    var t = screen.height/2 - h/2 - 150;

                    alert( returnMessage );
                    var url = "user/pm/pmUserPwModify.jsp" + "?app_id=" +'nportalYonsei';
                    var option = 'toolbar=no,directories=no,status=no,scrollbars=no,menubar=no,resizable=no';
                    //window.open(url,'s','left='+l+',top='+t+',width='+w+',height='+h+','+option);
                    location.href = url;
                }
                $('info').innerHTML = '<p class="error1" style="display:block;">' + returnMessage + '</p>';
            }
            $('loginId').focus();
        }
    } else {

        if( returnMessage != '' ) {
            if( retCode == '[PM_UAN]038' ) {
                var w = 550;
                var h = 450;
                var l = screen.width/2 - w/2 - 200;
                var t = screen.height/2 - h/2 - 150;

                alert( returnMessage );
                var url = "user/pm/pmUserPwModify.jsp" + "?app_id=" +'nportalYonsei';
                var option = 'toolbar=no,directories=no,status=no,scrollbars=no,menubar=no,resizable=no';
                //window.open(url,'s','left='+l+',top='+t+',width='+w+',height='+h+','+option);
                location.href = url;
            }
            $('info').innerHTML = '<p class="error1" style="display:block;">' + returnMessage + '</p>';
        }
        $('loginId').focus();
    }
/*
    document.querySelector('img[alt~="네이버인증서로그인"').addEventListener("keypress", function() {
          var loginId = $('loginNaverId').value;
          if( $('loginNaverId').value == '' ){
           alert( '아이디를 입력하여 주십시요1.' );
           $('loginNaverId').focus();
           return false;
         }
         NaverLoginex();
       });
*/

    document.querySelector("#loginId").addEventListener("keydown", function(e) {
        if(e.keyCode == 13){
            document.querySelector("#loginBtn").click();
        }
    });
    document.querySelector("#loginPasswd").addEventListener("keydown", function(e) {
        if(e.keyCode == 13){
            document.querySelector("#loginBtn").click();
        }
    });
    document.querySelector("#loginNaverId").addEventListener("keydown", function(e) {
        if(e.keyCode == 13){
            document.querySelector("#naverIdLogin_loginButton").click();
        }
    });
}


function NaverLoginex(e) {
    var loginNaverId     = $('loginNaverId').value;

    if( $('loginNaverId').value == '' ){
        alert( '아이디를 입력하여 주십시요2.' );
        $('loginNaverId').focus();
        e.stopImmediatePropagation()
        return false;
    }

    var btnNaverLogin = $('naverIdLogin').firstChild;
    btnNaverLogin.click();
};

function idPwLogin(selected){
    document.querySelector("ul.login-tab li.is-active").removeClassName("is-active")
    selected.parentElement.classList.add("is-active");
    document.querySelector("div.login-cont-wrap div.is-active").removeClassName("is-active");
    document.querySelector("div.login-cont-wrap div[id='id_pw'").addClassName("is-active");
    /*
    $('naverdisplay').hide();
    $('loginPasswd').show();
    $('loginBtn').show();
    */
    $('loginId').value = '';
    $('loginNaverId').value = '';
    $('loginPasswd').value = '';
    $('tap_check').value = 'id';
    //document.getElementById('idPwLogin').style.fontWeight='bold';
    //document.getElementById('certLogin').style.fontWeight='normal';
    /*
    document.getElementById('idPwLogin').style.color='#fff';
    document.getElementById('certLogin').style.color='#000';
    document.getElementById('linkWrap_tap').style.background='#003876';
    document.getElementById('linkWrap_tap2').style.background='#e4e5e6';
    document.getElementById('linkWrap_tap').style.border='1px solid #003876';
    document.getElementById('linkWrap_tap2').style.border='1px solid #ccc';
    document.getElementById('idPwLogin').title='선택됨';
    document.getElementById('certLogin').title='비선택';
    */

};

function certLogin(selected){

    document.querySelector("ul.login-tab li.is-active").removeClassName("is-active")
    selected.parentElement.classList.add("is-active");

    document.querySelector("div.login-cont-wrap div.is-active").removeClassName("is-active");
    document.querySelector("div.login-cont-wrap div[id='naver'").addClassName("is-active");

    /*
    $('naverdisplay').show();
    $('loginPasswd').hide();
    $('loginBtn').hide();
    */
    $('loginId').value = '';
    $('loginNaverId').value = '';
    $('loginPasswd').value = '';
    $('tap_check').value = 'cert';
    //document.getElementById('idPwLogin').style.fontWeight='normal';
    //document.getElementById('certLogin').style.fontWeight='bold';
    /*
    document.getElementById('idPwLogin').style.color='#000';
    document.getElementById('certLogin').style.color='#fff';
    document.getElementById('linkWrap_tap').style.background='#e4e5e6';
    document.getElementById('linkWrap_tap2').style.background='#003876';
    document.getElementById('linkWrap_tap').style.border='1px solid #ccc';
    document.getElementById('linkWrap_tap2').style.border='1px solid #003876';
    document.getElementById('idPwLogin').title='비선택';
    document.getElementById('certLogin').title='선택됨';
    */

};

/**
 * ID/PW 로그인 버튼
 */

 function fSubmitSSOLoginForm(){
    var tap_check     = $('tap_check').value;
    if( tap_check == 'id'){
        fSubmitSSOLoginForm2();
    }else{
        NaverLoginex(e);
    }
 }

function fSubmitSSOLoginForm2(){
    var loginId     = $('loginId').value;
    var loginPasswd = $('loginPasswd').value;

    if( $('loginId').value == '' ){
        alert( '아이디를 입력하여 주십시요3.' );
        $('loginId').focus();
        return false;
    }

    if( $('loginPasswd').value == '' ){
        alert( '비밀번호를 입력하여 주십시요.' );
        $('loginPasswd').focus();
        return false;
    }

    $('loginId').value = '';
    $('loginPasswd').value = '';

    var ssoChallenge= 'A0DB1EEB193DB9E6F01AF566D59CF2BE2F09C629';

    var jsonObj = {'userid':loginId, 'userpw':loginPasswd, 'ssoChallenge':ssoChallenge};
    var jsonStr = Object.toJSON( jsonObj );

    //document.ssoLoginForm.E2.value = rstr2hex( jsonStr );

    var rsa = new RSAKey();
    rsa.setPublic( '94c10c098dd118464876740282df91cae241d82598e6d963e07d8e1f1a47cee2cb5dfd5606c9e93a77304ee39fa56428fbc134a0cebbdef7edd43e6232be47ea85f6984e2e4e1114e0b608f53049c4a21f4faf151c9a0691d7e2eaac7f77e40c27f9ae97423385ea88a07abe182565af1f3c418ba1e8207b0acd1f83ea5d450b', '10001' );

    document.ssoLoginForm.E2.value = rsa.encrypt( jsonStr );

    /*
    var expDate  = new Date();
    expDate.setDate(expDate.getDate()+1);

    if (document.ssoLoginForm.idSave.checked == true) {
        jsSetCookie('cookieLoginId', loginId, expDate, '/');
    }else{
        jsSetCookie('cookieLoginId', '', expDate, '/');
    }
    */

    //return true;

    document.ssoLoginForm.submit();
}

/**
 * 네이버 인증서 로그인
 */
function fSubmitSSONaverCertLoginForm(jsonData){

    //var loginId     = $('loginId').value;
    var loginId     = $('loginNaverId').value

    if( $('loginNaverId').value == '' ){
        alert( '아이디를 입력하여 주십시요4.' );
        $('loginNaverId').focus();
        return false;
    }

    $('loginNaverId').value = '';
    $('loginPasswd').value = '';

    var ssoChallenge= 'A0DB1EEB193DB9E6F01AF566D59CF2BE2F09C629';

    // E2 : ssoChallenge, user_id
    // E3 : birthday, gender, mobile
    // E4 : name

    //var jsonObj = {'jsonData':jsonData, 'ssoChallenge':ssoChallenge};
    var R_jsonObj = JSON.parse(jsonData);
    var birthday = R_jsonObj.birthday;
    var gender = R_jsonObj.gender;
    var mobile = R_jsonObj.mobile;
    var name = R_jsonObj.name;
    var jsonObj = {'userid':loginId, 'ssoChallenge':ssoChallenge} ;
    var jsonStr = Object.toJSON( jsonObj );

    var E3_jsonObj = {'birthday' : birthday,'mobile':mobile, 'gender': gender} ;
    var E3_jsonStr = Object.toJSON( E3_jsonObj );
    var E4_jsonObj = {'name':name} ;
    var E4_jsonStr = Object.toJSON( E4_jsonObj );

    var rsa = new RSAKey();
    rsa.setPublic( '94c10c098dd118464876740282df91cae241d82598e6d963e07d8e1f1a47cee2cb5dfd5606c9e93a77304ee39fa56428fbc134a0cebbdef7edd43e6232be47ea85f6984e2e4e1114e0b608f53049c4a21f4faf151c9a0691d7e2eaac7f77e40c27f9ae97423385ea88a07abe182565af1f3c418ba1e8207b0acd1f83ea5d450b', '10001' );

    document.ssoLoginForm.E2.value = rsa.encrypt( jsonStr );
    document.ssoLoginForm.E3.value = rsa.encrypt( E3_jsonStr );
    document.ssoLoginForm.E4.value = rsa.encrypt( E4_jsonStr );

    document.ssoLoginForm.loginType.value = "invokeCert";


    document.ssoLoginForm.submit();
}



function fnd(){
    window.open('http://ysweb.yonsei.ac.kr/fndhakbun.jsp?langParam=0', 'FNDHAKBUN','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,titlebar=no, width=900,height=700');
}

function login_cancle(){
    location.href="http://portal.yonsei.ac.kr";
    //location.href="https://portal.yonsei.ac.kr:443";

}

function spop(){
    var url = "http://ysweb.yonsei.ac.kr/fndhakbun.jsp";
    var win = window.open(url, "ttt","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,titlebar=no, width=600,height=400");
    if(win.focus) win.focus();
}

function dohelp(){
    popupWin = window.open("http://underwood1.yonsei.ac.kr/haksa/HELP/dugrock-01.htm","Property_Sheet","statusbar=Y,resizable=N,scrollbars=N,width=700,height=630");
    popupWin.focus();
}

function dohelp2(){
    popupWin = window.open("http://cmsdv.yonsei.ac.kr/yis/sub05/sub0506/sub05_06.asp","_blank","");
    popupWin.focus();
}


function checkCertNew_id(){
    //alert('점검중입니다. 최대한 빨리 서비스를 재개토록 하겠습니다. 문의전화 : 02-2123-6395');
    //return;

    //win =window.open('https://infra.yonsei.ac.kr/lauth/yscert/yscert_1.jsp',"yscertpopup","width=450,height=550,top=50,left=50,menubar=no,resizable=no,status=no,toolbar=no,location=no,scrollbars=yes,directories=no");
    win =window.open('https://portal.yonsei.ac.kr/portal/MainCtr/findPersNo.do',"yscertpopup","width=450,height=550,top=50,left=50,menubar=no,resizable=no,status=no,toolbar=no,location=no,scrollbars=yes,directories=no");
    win.focus();
}

function checkCertNew_pwd(){
    //alert('점검중입니다. 최대한 빨리 서비스를 재개토록 하겠습니다. 문의전화 : 02-2123-6395');
    //return;

    //win =window.open('https://infra.yonsei.ac.kr/lauth/yscert/yscert_p_1.jsp',"yscertpopup","width=450,height=550,top=50,left=50,menubar=no,resizable=no,status=no,toolbar=no,location=no,scrollbars=yes,directories=no");
    win =window.open('https://portal.yonsei.ac.kr/portal/MainCtr/findPassWd.do',"yscertpopup","width=450,height=550,top=50,left=50,menubar=no,resizable=no,status=no,toolbar=no,location=no,scrollbars=yes,directories=no");
    win.focus();
}
/*
document.addEventListener('keydown', function(event) {
    if (event.keyCode === 13) {
        event.preventDefault();

        var tap_check     = $('tap_check').value;
        if( tap_check == 'id'){
            fSubmitSSOLoginForm();
        }else{
            NaverLoginex(e);
        }
    };
}, true);
*/

</script>


</head>




<body onload="fInitialize();" bgcolor="#FFFFFF" class="login login-min-height" >
    <div class="login-bg">
        <div class="login-wrap">







    <input type="hidden" id="tap_check" name="tap_check" value="id"/>

<form id="ssoLoginForm" name="ssoLoginForm" method="post" action="/sso/PmSSOAuthService" onsubmit="return false;" style="display:contents;">
    <input type="hidden" id="app_id"       name="app_id"        value="nportalYonsei" />
    <input type="hidden" id="retUrl"       name="retUrl"        value="https://portal.yonsei.ac.kr:443" />
    <input type="hidden" id="failUrl"      name="failUrl"       value="https://portal.yonsei.ac.kr:443" />
    <input type="hidden" id="baseUrl"      name="baseUrl"       value="https://portal.yonsei.ac.kr:443" />
    <input type="hidden" id="loginUrl"     name="loginUrl"      value="" />
    <input type="hidden" id="loginType"    name="loginType"     value="invokeID" />
    <input type="hidden" id="E2"           name="E2"            value="" />
    <input type="hidden" id="E3"           name="E3"            value="" />
    <input type="hidden" id="E4"           name="E4"            value="" />


<!-- 여기서 작업 변경 -->
     <div class="box01">
        <p class="text01">나는 <span>연세인</span><br><span>나의 미래</span>를 만든다!</p>
        <p class="text02">진리와 자유를 향한 연세의 도전</p>
    </div>
    <form action="">
        <div class="box02">
            <div>
                <div class="login-top">
                    <div class="logo-wrap"></div>
                    <ul class="login-tab">
                        <li class="is-active">
                            <a href="#none;" onclick="javascript:idPwLogin(this);">ID&PW 로그인</a>
                        </li>
                        <li>
                            <a href="#none;" onclick="javascript:certLogin(this);">네이버 인증서 로그인</a>
                        </li>
                    </ul>
                </div>
                <div class="login-cont-wrap">
                    <div>
                        <!-- 오픈전 임시로 문구 표시 -->
                        <div style="height:30px;">※ 기존 연세포털(https://portal.yonsei.ac.kr)의 비밀번호로 로그인해 주십시오.</div>       
                        <div id="id_pw" class="login-cont is-active">
                            <input type="text" id="loginId" name="loginId" title="아이디 혹은 학번" placeholder="학번(교번) (ID No.)" maxlength="16">
                            <input type="password" id="loginPasswd" name="loginPasswd" title="비밀번호" placeholder="비밀번호 (Password)" maxlength="16" style="display:block;">

                            <div id="info" class="error info">
                                로그인 정보 > ID : 교직원 번호, 초기비밀번호 : 생년월일 6자리<br/>
                                <font class="info-en">INFO > ID : Employee number, Init PW: BirthDay (6 digit)</font>
                                <p class="error1" style="display:block;"></p>
                            </div>

                            <a href="#none;" id="loginBtn" class="submit" onclick="fSubmitSSOLoginForm()">로그인(Login)</a>

                        </div>
                        <div id="naver" class="login-cont">
                            <input id="loginNaverId" type="text" name="loginId" title="아이디 혹은 학번" placeholder="학번(교번) (ID No.)">                            <div id="info" class="error info">
                                로그인 정보 > ID : 교직원 번호, 초기비밀번호 : 생년월일 6자리<br/>
                                <font class="info-en">INFO > ID : Employee number, Init PW: BirthDay (6 digit)</font>
                                <p class="error1" style="display:block;"></p>
                            </div>
                            <a id="naverIdLogin_loginButton" onclick="NaverLoginex(event);">네이버 인증서 로그인</a>
                        </div>
                    </div>
                    <p>이용 후 반드시 로그아웃 해주세요!<br>Please be sure to log out after use.</p>
                </div>
            </div>
            <div class="m_box02">
                <ul>
                    <li>
                        <a href="javascript:checkCertNew_id();" title="새 창 열림"><span>아이디 찾기</span></a>
                    </li>
                    <li>
                        <a href="javascript:checkCertNew_pwd();" title="새 창 열림"><span>임시 비밀번호 발급</span></a>
                    </li>
                    <li>
                        <a href="https://underwood1.yonsei.ac.kr/haksa/HELP/dugrock-01.htm" target="_blank" title="새 탭 열림"><span>로그인
 도움말</spa></a>
                    </li>
                </ul>
                <p>COPYRIGHT&copy; 2022 YONSEI UNIV. ALL RIGHTS RESERVED.</p>
            </div>
        </div>

        <div id="naverIdLogin" style="display:none;"></div>
        <div id="naverdisplay" style="display:none;"><a id="naverIdLogin_loginButton" onclick="NaverLoginex(event);" ><img src="/sso/user/pm/img/btnW_naver.png" tabindex="0" alt="네이버인증서로그인" style="width:260px;cursor:pointer;"/></a></div>

    </form>
    <div class="box03">
        <ul>
            <li>
                <a href="javascript:checkCertNew_id();" title="새 창 열림"><span>아이디 찾기</span></a>
            </li>
            <li>
                <a href="javascript:checkCertNew_pwd();" title="새 창 열림"><span>임시 비밀번호 발급</span></a>
            </li>
            <li>
                <a href="https://underwood1.yonsei.ac.kr/haksa/HELP/dugrock-01.htm" target="_blank" title="새 탭 열림"><span>로그인 도움말</spa></a>
            </li>
        </ul>
    </div>
</form>



        <!-- (2) LoginWithNaverId Javscript SDK -->
        <script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.1.js"></script>
        <!-- (3) LoginWithNaverId Javscript 설정 정보 및 초기화 -->
            <script>
            window.name='opener';
            var naverLogin = new naver.LoginWithNaverId(
                {
                    clientId: "4JwXlRmFN3fGWDQdKLn9",
                    callbackUrl: document.location.protocol + "//" + document.location.host + "/sso/callback.jsp",
                    isPopup: true,
                    loginButton: {color: "green", type: 3, height: 60}
                }
            );
            /* (4) 네아로 로그인 정보를 초기화하기 위하여 init을 호출 */
            naverLogin.init();

            /* (5) 현재 로그인 상태를 확인 */
            function callBackFunction(event) {
                console.log(event.data);
                console.log(event);
                if(event.origin == 'https://infra.yonsei.ac.kr'){

                    naverLogin.getLoginStatus(function (status) {
                        console.log(status);
                        if (event.data != "") {

                            fSubmitSSONaverCertLoginForm(event.data);
                        }
                    });
                }
            };

            if( window.attachEvent ) {
                window.attachEvent("onmessage", callBackFunction );
            } else if( window.addEventListener ){
                window.addEventListener( "message" , callBackFunction );
            }
        </script>



        </div>
        <p class="copy">COPYRIGHT&copy; 2022 YONSEI UNIV. ALL RIGHTS RESERVED.</p>
    </div>
</body>
</html>






